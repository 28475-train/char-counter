<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ã‚«ã‚¹ã‚¿ãƒ  ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆãƒ»ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ ãƒ„ãƒ¼ãƒ«</title>
<meta name="description" content="ç›®æ¨™å›æ•°ã€é–‹å§‹æ™‚åˆ»ã€ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆãƒ¢ãƒ¼ãƒ‰ã‚’è‡ªç”±ã«è¨­å®šã§ãã‚‹ã‚«ã‚¹ã‚¿ãƒ ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚">
<link rel="stylesheet" href="style.css">
<style>
/* ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆå°‚ç”¨CSS */
.roulette-wrapper {
    display: none; /* åˆæœŸçŠ¶æ…‹ã§ã¯éè¡¨ç¤º */
    justify-content: center;
    align-items: center;
    margin-top: 30px;
    height: 300px;
}
.roulette-circle {
    width: 250px;
    height: 250px;
    border: 5px solid var(--accent);
    border-radius: 50%;
    position: relative;
    background-color: var(--background);
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
}
.roulette-needle {
    width: 50%;
    height: 4px;
    background-color: red;
    position: absolute;
    top: calc(50% - 2px); 
    left: 50%;
    transform-origin: 0% 50%; 
    transform: rotate(0deg);
    transition: transform 0.1s linear; 
}
.roulette-center {
    width: 20px;
    height: 20px;
    background-color: var(--accent-dark);
    border-radius: 50%;
    position: absolute;
    top: calc(50% - 10px);
    left: calc(50% - 10px);
    z-index: 10;
}
.roulette-text {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 1.5em;
    font-weight: bold;
    color: var(--text-highlight);
    z-index: 5;
}
/* ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ã‚¯ãƒ©ã‚¹ */
.roulette-needle.animating {
    animation: spin 0.1s linear infinite;
}
@keyframes spin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}
</style>
</head>
<body data-theme="light_green">
<script>
const savedTheme = localStorage.getItem('theme');
if (savedTheme) {
    document.body.setAttribute('data-theme', savedTheme);
}
</script>

<header class="header">
    <a href="counter.html" class="header-title">ğŸ² ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆãƒ»ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³</a>
    <nav class="header-nav">
        <a href="counter.html">ğŸ“ ã‚«ã‚¦ãƒ³ãƒˆ</a> 
        <a href="settings.html">âš™ è¨­å®š</a>
        <a href="help.html">ãƒ˜ãƒ«ãƒ—</a>
        <a href="about.html">åˆ¶ä½œè€…</a>
    </nav>
</header>
<div class="content-wrapper">

<h1>ã‚«ã‚¹ã‚¿ãƒ  ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆãƒ»ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³</h1>

<div id="customCounterContainer" class="card" style="margin-top: 20px; padding: 30px; text-align: center;">
  <h2 id="customCounterTitle" style="margin-top: 0; font-size: 1.4em;">ç¾åœ¨ã®ã‚«ã‚¹ã‚¿ãƒ ç›®æ¨™</h2>
  
  <div class="roulette-wrapper" id="rouletteWrapper">
    <div id="rouletteCircle" class="roulette-circle">
        <div id="rouletteNeedle" class="roulette-needle"></div>
        <div class="roulette-center"></div>
        <div id="customCounterDisplay" class="roulette-text">---</div>
    </div>
  </div>
  
  <div id="simpleDisplay" style="font-size: 4em; font-weight: bold; color: var(--text-highlight); min-height: 1.2em;">
    ---
  </div>

  <p id="customCounterLabel" style="font-size: 1.1em; margin-top: 10px;">è¨­å®šç”»é¢ã§ç›®æ¨™ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚</p>

  <div style="margin-top: 20px;">
      <a href="settings.html" style="text-decoration: none; padding: 8px 15px; background-color: var(--accent); color: white; border-radius: 6px;">è¨­å®šç”»é¢ã¸</a>
  </div>
</div>

<div id="ad-area" style="margin-top: 30px;">
<script src="https://adm.shinobi.jp/o/908d65c8b7bcdd909305dd25f407426f"></script>
</div>
</div>

<script>
const customContainer = document.getElementById('customCounterContainer');
const rouletteWrapper = document.getElementById('rouletteWrapper');
const simpleDisplay = document.getElementById('simpleDisplay'); // æ–°è¨­ã®æ•°å­—è¡¨ç¤ºã‚¨ãƒªã‚¢
const customDisplay = document.getElementById('customCounterDisplay'); // ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆå†…ã®æ•°å­—
const customLabel = document.getElementById('customCounterLabel');
let customSettings = {};
let counterInterval = null; 

function loadCustomCounterSettings() {
    const savedSettings = localStorage.getItem('customCounterSettings');
    if (savedSettings) {
        customSettings = JSON.parse(savedSettings);
    } else {
        customSettings = { target: 1000, start: null, mode: 'none' };
    }

    if (customSettings.mode !== 'none') {
        startCustomCounter();
    } else {
        simpleDisplay.textContent = '---';
        customLabel.textContent = 'ã‚«ã‚¹ã‚¿ãƒ ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã¯ç¾åœ¨ã€Œç„¡åŠ¹ã€ã§ã™ã€‚è¨­å®šã‚’å¤‰æ›´ã—ã¦ãã ã•ã„ã€‚';
        rouletteWrapper.style.display = 'none';
        simpleDisplay.style.display = 'block';
    }
}

// ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³é–¢æ•° (é‡å›è»¢ç‰ˆ)
function runRouletteAnimation(targetCount) {
    const ROULETTE_DURATION = 3000; 
    const needle = document.getElementById('rouletteNeedle');
    const label = document.getElementById('customCounterLabel');
    
    // è¡¨ç¤ºåˆ‡æ›¿
    rouletteWrapper.style.display = 'flex';
    simpleDisplay.style.display = 'none';
    customDisplay.textContent = '?'; 

    needle.classList.add('animating');
    
    setTimeout(() => {
        needle.classList.remove('animating');
        
        // æœ€çµ‚çš„ãªè§’åº¦ã‚’è¨­å®š (ä¾‹: 10å‘¨ + ãƒ©ãƒ³ãƒ€ãƒ ãªè§’åº¦)
        const finalAngle = 360 * 10 + Math.floor(Math.random() * 360);
        needle.style.transform = `rotate(${finalAngle}deg)`;

        customDisplay.textContent = targetCount.toLocaleString();
        label.textContent = `ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆå®Œäº†ï¼ç›®æ¨™å€¤ ${targetCount.toLocaleString()} ã§æ±ºå®šã—ã¾ã—ãŸã€‚`;
    }, ROULETTE_DURATION);
}

// ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã®é–‹å§‹é–¢æ•°
function startCustomCounter() {
    if (counterInterval) clearInterval(counterInterval); 

    const { target, start, mode } = customSettings;
    const targetVal = parseInt(target, 10);

    if (mode === 'roulette') {
        customLabel.textContent = `ç›®æ¨™å€¤ ${targetVal.toLocaleString()} ã«å‘ã‘ã¦ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆã‚’é–‹å§‹ã—ã¾ã™...`;
        runRouletteAnimation(targetVal);
        return;
    }

    // ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆä»¥å¤–ã®è¡¨ç¤ºè¨­å®š
    rouletteWrapper.style.display = 'none';
    simpleDisplay.style.display = 'block';

    if (mode === 'countdown') {
        customLabel.textContent = `ç›®æ¨™å€¤ ${targetVal.toLocaleString()} å›ã‹ã‚‰ã®ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ä¸­...`;
        let currentValue = targetVal;
        
        simpleDisplay.textContent = currentValue.toLocaleString();
        
        counterInterval = setInterval(() => {
            currentValue--;
            simpleDisplay.textContent = currentValue.toLocaleString();

            if (currentValue <= 0) {
                clearInterval(counterInterval);
                simpleDisplay.textContent = "0";
                customLabel.textContent = "ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³å®Œäº†ï¼";
            }
        }, 1000); // 1ç§’é–“éš”

    } else if (mode === 'countup' && start) {
        const startDate = new Date(start).getTime();
        customLabel.textContent = `${new Date(start).toLocaleString()} ã‹ã‚‰ã®çµŒéæ™‚é–“`;

        counterInterval = setInterval(() => {
            const now = Date.now();
            if (isNaN(startDate)) {
                 simpleDisplay.textContent = 'é–‹å§‹æ™‚åˆ»ãŒç„¡åŠ¹ã§ã™';
                 clearInterval(counterInterval);
                 return;
            }

            const elapsedMs = now - startDate;
            const totalSeconds = Math.floor(elapsedMs / 1000);

            const hours = String(Math.floor(totalSeconds / 3600)).padStart(2, '0');
            const minutes = String(Math.floor((totalSeconds % 3600) / 60)).padStart(2, '0');
            const seconds = String(totalSeconds % 60).padStart(2, '0');
            
            simpleDisplay.textContent = `${hours}:${minutes}:${seconds}`;
            
        }, 1000); // 1ç§’é–“éš”
    }
}

window.addEventListener('load', loadCustomCounterSettings);
</script>
</body>
</html>
