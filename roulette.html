<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ã‚«ã‚¹ã‚¿ãƒ  ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆãƒ»ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ ãƒ„ãƒ¼ãƒ«</title>
<meta name="description" content="ç›®æ¨™å›æ•°ã€é–‹å§‹æ™‚åˆ»ã€ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆãƒ¢ãƒ¼ãƒ‰ã‚’è‡ªç”±ã«è¨­å®šã§ãã‚‹ã‚«ã‚¹ã‚¿ãƒ ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚">
<link rel="stylesheet" href="style.css">
</head>
<body data-theme="light_green">
<script>
// ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚ã®ãƒ†ãƒ¼ãƒé©ç”¨ (å…±é€š)
const savedTheme = localStorage.getItem('theme');
if (savedTheme) {
    document.body.setAttribute('data-theme', savedTheme);
}
</script>

<header class="header">
    <a href="counter.html" class="header-title">ğŸ² ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆãƒ»ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³</a>
    <nav class="header-nav">
        <a href="counter.html">ğŸ“ ã‚«ã‚¦ãƒ³ãƒˆ</a> 
        <a href="settings.html">âš™ è¨­å®š</a>
        <a href="help.html">ãƒ˜ãƒ«ãƒ—</a>
        <a href="about.html">åˆ¶ä½œè€…</a>
    </nav>
</header>
<div class="content-wrapper">

<h1>ã‚«ã‚¹ã‚¿ãƒ  ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆãƒ»ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³</h1>

<div id="customCounterContainer" class="card" style="margin-top: 20px; padding: 30px; border: 2px solid var(--accent); text-align: center;">
  <h2 style="margin-top: 0; font-size: 1.4em;">ç¾åœ¨ã®ã‚«ã‚¹ã‚¿ãƒ ç›®æ¨™</h2>
  
  <div id="customCounterDisplay" style="font-size: 4em; font-weight: bold; color: var(--text-highlight); min-height: 1.2em;">
    ---
  </div>
  
  <p id="customCounterLabel" style="font-size: 1.1em; margin-top: 10px;">è¨­å®šç”»é¢ã§ç›®æ¨™ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚</p>

  <div style="margin-top: 20px;">
      <a href="settings.html" style="text-decoration: none; padding: 8px 15px; background-color: var(--accent); color: white; border-radius: 6px;">è¨­å®šç”»é¢ã¸</a>
  </div>
</div>
<div id="ad-area" style="margin-top: 30px;">
<script src="https://adm.shinobi.jp/o/908d65c8b7bcdd909305dd25f407426f"></script>
</div>
</div>

<script>
// === â˜…â˜…â˜… ã‚«ã‚¹ã‚¿ãƒ ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼æ©Ÿèƒ½ã®ãƒ­ã‚¸ãƒƒã‚¯ (ã‚³ã‚¢) â˜…â˜…â˜…
const customContainer = document.getElementById('customCounterContainer');
const customDisplay = document.getElementById('customCounterDisplay');
const customLabel = document.getElementById('customCounterLabel');
let customSettings = {};
let counterInterval = null; 

function loadCustomCounterSettings() {
    const savedSettings = localStorage.getItem('customCounterSettings');
    if (savedSettings) {
        customSettings = JSON.parse(savedSettings);
    } else {
        customSettings = { show: true, target: 1000, start: null, mode: 'none' };
    }

    if (customSettings.mode !== 'none') {
        startCustomCounter();
    } else {
        customDisplay.textContent = '---';
        customLabel.textContent = 'ã‚«ã‚¹ã‚¿ãƒ ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã¯ç¾åœ¨ã€Œç„¡åŠ¹ã€ã§ã™ã€‚è¨­å®šã‚’å¤‰æ›´ã—ã¦ãã ã•ã„ã€‚';
    }
}

// ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³é–¢æ•°
function runRouletteAnimation(targetCount) {
    const ROULETTE_DURATION = 3000; 
    let startTime = null;
    let frameId;

    function step(timestamp) {
        if (!startTime) startTime = timestamp;
        const progress = timestamp - startTime;
        const ratio = Math.min(progress / ROULETTE_DURATION, 1);

        if (ratio < 1) {
            // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ä¸­: ãƒ©ãƒ³ãƒ€ãƒ ãªæ•°å­—ã‚’è¡¨ç¤º
            const countLength = String(targetCount).length > 3 ? String(targetCount).length : 4;
            let randomNum = '';
            for (let i = 0; i < countLength; i++) {
                randomNum += Math.floor(Math.random() * 10);
            }
            customDisplay.textContent = randomNum;
            frameId = window.requestAnimationFrame(step);
        } else {
            // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³çµ‚äº†: æœ€çµ‚çš„ãªæ•°å­—ã‚’è¡¨ç¤º
            customDisplay.textContent = targetCount.toLocaleString();
            customLabel.textContent = `ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆå®Œäº†ï¼ç›®æ¨™å€¤ ${targetCount.toLocaleString()} ã§åœæ­¢ã—ã¾ã—ãŸã€‚`;
            window.cancelAnimationFrame(frameId);
        }
    }

    frameId = window.requestAnimationFrame(step);
}

// ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã®é–‹å§‹é–¢æ•°
function startCustomCounter() {
    if (counterInterval) clearInterval(counterInterval); 

    const { target, start, mode } = customSettings;
    const targetVal = parseInt(target, 10);

    if (mode === 'roulette') {
        customLabel.textContent = `ç›®æ¨™å€¤ ${targetVal.toLocaleString()} ã«å‘ã‘ã¦ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆã‚’é–‹å§‹ã—ã¾ã™...`;
        runRouletteAnimation(targetVal);
        return;
    }

    if (mode === 'countdown') {
        customLabel.textContent = `ç›®æ¨™å€¤ ${targetVal.toLocaleString()} å›ã‹ã‚‰ã®ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ä¸­...`;
        let currentValue = targetVal;
        
        customDisplay.textContent = currentValue.toLocaleString();
        
        counterInterval = setInterval(() => {
            currentValue--;
            customDisplay.textContent = currentValue.toLocaleString();

            if (currentValue <= 0) {
                clearInterval(counterInterval);
                customDisplay.textContent = "0";
                customLabel.textContent = "ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³å®Œäº†ï¼";
            }
        }, 1000); 

    } else if (mode === 'countup' && start) {
        const startDate = new Date(start).getTime();
        customLabel.textContent = `${new Date(start).toLocaleString()} ã‹ã‚‰ã®çµŒéæ™‚é–“`;

        counterInterval = setInterval(() => {
            const now = Date.now();
            if (isNaN(startDate)) {
                 customDisplay.textContent = 'é–‹å§‹æ™‚åˆ»ãŒç„¡åŠ¹ã§ã™';
                 clearInterval(counterInterval);
                 return;
            }

            const elapsedMs = now - startDate;
            const totalSeconds = Math.floor(elapsedMs / 1000);

            // æ™‚åˆ»è¡¨ç¤ºå½¢å¼ (HH:MM:SS)
            const hours = String(Math.floor(totalSeconds / 3600)).padStart(2, '0');
            const minutes = String(Math.floor((totalSeconds % 3600) / 60)).padStart(2, '0');
            const seconds = String(totalSeconds % 60).padStart(2, '0');
            
            customDisplay.textContent = `${hours}:${minutes}:${seconds}`;
            
        }, 1000); 
    }
}

// ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚ã«ã‚«ã‚¹ã‚¿ãƒ ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã®è¨­å®šã‚’èª­ã¿è¾¼ã‚€
window.addEventListener('load', loadCustomCounterSettings);
// â˜…â˜…â˜… ã“ã“ã¾ã§ã‚«ã‚¹ã‚¿ãƒ ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ â˜…â˜…â˜…
</script>
</body>
</html>
